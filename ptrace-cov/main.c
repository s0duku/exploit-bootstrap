
#include "headers/tracer.h"
#include <stdlib.h>
#include <stdio.h>
#include <signal.h>

int is_exit = 0;

void sig_int_handler(int sig) {
    printf("\n");
    printf("[*] SIGINT received.\n");
    printf("[*] Exiting...\n");
    is_exit = 1;
}

int main(int argc, char **argv, char **envp) {
    if (argc < 2){
        printf("[*] Usage: %s <pid>\n", argv[0]);
        exit(0);
    }

    pid_t pid = atoi(argv[1]);

    if(tracer_attach(pid) < 0){
        printf("[*] Failed to attach to %d\n", pid);
        exit(0);
    }

    printf("[*] Attached to %d\n", pid);
    int child_status;
    unsigned int step_cnt = 0;

    while (!is_exit){
        if(tracer_step(pid,&child_status) < 0){
            printf("[*] Failed to step\n");
            break;;
        }
        step_cnt++;
        //printf("steps: %d \r",step_cnt);
    }

    tracer_detach(pid);
    
    return 0;
}