

CXX = clang++-14
CFLAGS = -lprotobuf

PROTO_BUF_CC = protoc
PROTO_BUF_SRC_DIR = `pwd`
PROTO_BUF_CPP_DIR = `pwd`
PROTO_BUF_SRC = DemoMsg.proto
PROTO_BUF_CPP = DemoMsg.pb.cc

DEMO = demo
DEMO_SRC = main.cc 

MSG_BINARY = msg

$(DEMO): $(DEMO_SRC) $(PROTO_BUF_CPP)
	$(CXX) $(CFLAGS) -o $(DEMO) $(DEMO_SRC) $(PROTO_BUF_CPP)

$(PROTO_BUF_CPP): $(PROTO_BUF_SRC)
	$(PROTO_BUF_CC) -I=$(PROTO_BUF_SRC_DIR) --cpp_out=$(PROTO_BUF_CPP_DIR) $(PROTO_BUF_SRC)

$(MSG_BINARY):
	touch $(MSG_BINARY)

read: $(DEMO) $(MSG_BINARY)
	./$(DEMO) r $(MSG_BINARY)

write: $(DEMO) $(MSG_BINARY)
	./$(DEMO) w $(MSG_BINARY)

clean: 
	rm -rf $(PROTO_BUF_CPP) $(DEMO) $(MSG_BINARY)
